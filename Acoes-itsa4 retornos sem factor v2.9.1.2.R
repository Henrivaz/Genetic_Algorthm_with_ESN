#getwd()
setwd("C:\\Users\\henri\\OneDrive\\Área de Trabalho\\BolsaFURG\\ArqItsa4")

#TESTE das Distribuições


#BIBLIOTECAS
library(ggplot2)               #Plota os gráficos
library(PerformanceAnalytics)  #Assimetria e curtose
library(pracma)                #Tic e Toc (demarcadores de tempo de execução)
library(readxl)


#SÉRIES TEMPORAIS
#data = as.matrix(read.csv2('Retornos ITSA4_close sem factor_2001-30-06-2023.txt',header=F))       #5571 sem factor
#data = as.numeric(data)
#data
#length(data)
#View(data)                    # 5571 observações
#summary(data)
#describe(data)

#data_simulate = as.matrix(read.csv2('Retornos Log simulados Arma(7,0) 02-01-2001-28-12-2018.txt',header=F))
#data_simulate = as.numeric(data_simulate)

#data_simulate = as.matrix(read.csv2('Retornos Log simulados Arma(7,0) 02-01-2001-28-12-2018 v1.2.txt',header=F))
#data_simulate = as.numeric(data_simulate)

#data_simulate = as.matrix(read.csv2('Retornos Log simulados Arma(7,0) 02-01-2001-28-12-2018 v1.3.txt',header=F))
#data_simulate = as.numeric(data_simulate)


#data_simulate = as.matrix(read.csv2('Retornos Log simulados v1.4 Arma(7,0) 02-01-2001-28-12-2018.txt',header=F))
#data_simulate = as.numeric(data_simulate)

#data_simulate = as.matrix(read.csv2('Retornos Log simulados v1.5 Arma(7,0) 02-01-2001-28-12-2018.txt',header=F))
#data_simulate = as.numeric(data_simulate)

data_simulate = as.matrix(read.csv2('Retornos Log simulados v1.6 Arma(7,0) 02-01-2001-28-12-2018.txt',header=F))
data_simulate = as.numeric(data_simulate)


data_variance = as.matrix(read.csv2('ITSA4 variância diária teste 02-01-2019 - 30-06-2023.txt', header=F))
data_variance = as.numeric(data_variance)

#TAMANHOS TREINO, VALIDAÇÃO E TESTE
#treino   = 4453                #80% (02/01/2001 a 28/12/2018)  
treino   = 3335                #60% (02/01/2001 a 23/06/2014) 
valida   = 1118                #20% (24/06/2014 a 28/12/2018)   
teste    = 1118                #20% (02/01/2019 a 30/6/2023) 


#VALIDAÇÃO E TESTE
#Para cálculo do RRSE
train             = data_simulate[1:treino]                                               #Sem factor
#plot(train,   type="l")
train_media       = mean(train)


#Para gerar gráficos com data
#par(mfrow=c(1,2))
#data_date = as.matrix(read.csv2('ITSA4_retornos_close_2001-30-06-2023_com data.csv',header=F))
#data_date = as.matrix(read_excel('ITSA4_retornos_close_2001-30-06-2023_com data.xlsx',col_names=T,sheet=1))
#5198 sem factor
#data_date_1 = as.Date(data_date[1:5571,1])
#data_date_1
#length(data_date_1)
#data_date_2 = as.numeric(data_date[1:5571,2])     
#data_date_2
#plot(data_date_1,data_date_2,xlab="Date",ylab="Raw data (R$)",type="l",main="Daily closing price of ITSA4 stock \n between 2000 and 2020 \n (raw data/without factor)")

#par(mfrow=c(1,3))
#plot(data_date_1[1:treino],data[1:treino],ylim = c(5,180), xlab="Date",ylab="Closing price of ITSA4 stock without factor (R$)",type="l",main="Training data")
#plot(data_date_1[(treino+1):(treino+valida)],data[(treino+1):(treino+valida)],ylim = c(5,180),xlab="Date",ylab="Closing price of ITSA4 stock without factor (R$)",type="l",main="Validation data")
#plot(data_date_1[(treino+valida+1):5198],data[(treino+valida+1):5198],ylim = c(5,180),xlab="Date",ylab="Closing price of PETR4 stock without factor (R$)",type="l",main="Test data")

#par(mfrow=c(1,2))
#plot(data,xlab="Time (days)",ylab="Raw data (R$)",type="l",main="Daily closing price of PETR4 stock \n between 2000 and 2020 \n (raw data/without factor)")
#plot(data_fac,xlab="Time (days)",ylab="Data with factor (R$)",yaxis = c(),type="l",main="Daily closing price of PETR4 stock \n between 2000 and 2020 \n (data with factor applied)")
#plot(data_date_1,data,ylim=c(0,200),xlab="Date (a)",ylab="Raw data (R$)",type="l")#,main="Daily closing price of PETR4 stock \n between 2000 and 2020")


#Hiperparâmetros das ESN
inSize = outSize = 1

#Distribuição: UNIFORME

#Dados treinados e validados com retornos(sem factor) 10000_1, () otimizado por MAE, elapsed time is  seconds v2.9.1.1     #T STUDENT
#tourSelection, spCrossover, raMutation, keepBest=T, pmutation=0.1, elitism = 1, optim=F
a             = 0.745374644276766
sr            = 0.664670293199869
initLen       = 7
tam_reservoir = 21
reg           = 4.18572581213307e-05
#Win = Distribuição <colocar aqui os valores de -Winpar e Winpar>
Win           = matrix(nrow = 21, ncol = 2, c(-0.228246829472482,0.109965690877289,0.797317475546151,-0.143796586897224,0.740453789010644,0.55025474075228,0.108328598551452,-0.917728166095912,-0.280198437161744,-0.708111106883734,-0.672968611121178,0.71806280547753,-0.400861583650112,0.395590397994965,-0.365333232562989,-0.160811035428196,-0.760502593126148,-0.300114077981561,0.26300830533728,0.220869827549905,0.536961594596505,
                                              0.797808107919991,-0.392896367702633,-0.760504649952054,-0.86895135929808,-0.349365226924419,0.991055339574814,-0.493668986484408,0.632022952195257,0.0365389143116772,0.780982360243797,-0.154573223087937,-0.329979250673205,0.319370781071484,-0.568961948156357,-0.219300607219338,0.718505123630166,0.406674759462476,0.68665461987257,0.854150437749922,-0.302823695819825,-0.956894387491047))
#W   = Distribuição 
W             = matrix(nrow = 21, ncol = 21, c(-0.0117223407862886,0.0303650289394451,-0.12272476509155,0.0569723534850196,0.239107227760599,-0.166160471765021,0.183289246391448,0.0325080700905043,0.208537973602709,-0.061098708786009,0.012068031887789,0.240310785031172,-0.138048844070641,0.00557937964222254,0.243554012951837,0.199528808556551,0.0688780469619191,-0.0446470031720604,0.23873040986977,0.106135740899752,0.212163936992972,
                                               0.058352152351547,-0.145025472811671,-0.0596087253278125,-0.193751575905704,-0.213212272697388,0.167005934268988,0.128970598479951,-0.181857686335926,0.0460510279860599,0.0158804288846738,0.075244293578142,0.173491799352454,-0.247433692969327,0.228419837625557,0.24092878875743,0.216883506190243,0.188355014446977,-0.255154586492279,-0.0477264151621686,-0.146291757292206,-0.200234468324601,
                                               0.138879533127958,0.0301670986797918,0.167011633969857,-0.0332614147432885,0.103402835521999,0.127873570127387,-0.00317818967993986,0.0422732496999853,0.0203256049294919,0.0899853721719037,-0.213896090799703,-0.202916627151865,0.133038529003247,-0.244213897985578,-0.16067226333638,0.242661838576088,0.139229751039714,0.0289737815455261,0.152083447885504,0.1067706396009,0.122402854431592,
                                               0.211764343173972,0.0713473597059853,-0.039371845579343,-0.170824265344861,-0.208262287683048,0.251492092740759,0.0323462123110125,0.171260243773178,-0.00586479306636575,-0.189280824145447,-0.162635029212792,0.108637462575214,0.226668372561775,-0.228608019880455,-0.0033815118863654,-0.0355251936264898,-0.168574769526782,0.0841425808984042,-0.015465566112428,-0.0897480303876429,0.105532327367703,
                                               0.146603072811133,0.0858470004609636,-0.170180516275906,0.20189017711377,0.259757927267431,0.032466570913108,-0.00953350340063484,0.00971186464980463,0.0849572728677836,0.232341110321689,-0.0835779368824176,-0.133353276442856,0.0647547545767001,-0.175872345414946,-0.186125715647741,0.096780940752839,0.117763875557061,-0.0388943363482091,-0.0668504013468919,0.0656178294401051,-0.264320721127862,
                                               0.0819305232036645,0.0452101999187824,-0.10001463717163,-0.223165344932911,0.0623170338781562,-0.12997507610057,0.205498641021098,0.225073996089001,-0.0796750914315718,-0.20799419486446,-0.0612592207975873,0.250509518161691,0.25328610812093,-0.203082885114928,0.164614881816646,-0.153419424543713,-0.041736130050376,0.111482588196732,-0.0934533940848056,-0.257131098551667,0.263203290128718,
                                               0.081716433603914,-0.0627272035879325,0.175128269010531,0.153211931656772,0.171869605384401,0.0188044355561791,-0.0598634630936314,0.0858196557219773,-0.118253303571846,-0.0311154710535935,-0.164995259629862,0.0978101082021054,0.0675741102301938,0.211608179595276,0.164606363953264,-0.25584469005326,0.175801462721425,-0.239444198121018,0.0324778056876543,-0.211299728614479,0.185734110310075,
                                               -0.263821936738534,0.0692828085997085,0.0204687379597383,0.0343455861747139,-0.164573266762707,-0.0890232539901313,0.123033535451598,0.0206400967406981,0.23704046924994,-0.0176792867043026,-0.10523202774541,0.142007677016737,0.0361081653864374,-0.16198509831155,-0.229809868628285,0.059760520598362,-0.0848064492351676,-0.073488676084086,-0.138664075259994,-0.0264765873053287,-0.107311535675777,
                                               -0.0409540888906121,0.099981934861329,-0.159356521072512,0.11195345433944,-0.087205408167753,-0.0441771894183611,-0.105891439147847,-0.0317885461379081,-0.158994187374481,0.0682510897414803,-0.135343654936819,-0.0372391370658217,-0.013693284146551,-0.249074523185448,-0.163608956926762,-0.114321824239854,-0.0314772897447686,0.0350247949656743,-0.0674286232936146,-0.0247291094196192,-0.086451722385428,
                                               -0.047480545639395,-0.065101193813159,-0.0294721719296094,0.00713190243288126,-0.118114876979247,0.121359971799762,0.168008446113441,0.0337272289437497,0.0365126630207127,-0.0309250341436844,0.135760305107857,0.00324195502872156,-0.179650220077303,0.185282577924719,0.159759907441995,-0.192488724720869,0.088344027323933,-0.132183403745659,-0.11613480024741,0.0343414673698884,-0.241975887945387,
                                               -0.0827095695735648,-0.179198312686956,0.227074753096113,-0.136089227986156,-0.253453826103427,0.226951762708986,0.189693163634105,0.0826951812570416,-0.209937730484898,0.0768956875598769,0.109515367886027,0.239065544580754,0.056994965536009,-0.108123820738118,0.256922882905105,-0.0881537267908392,-0.0588756966954552,-0.0940520230531666,-0.073272907836991,0.0754619704756431,0.0665366586706575,
                                               -0.025036813515474,-0.108321682371858,0.13959560703463,-0.102298120817122,0.0903586128901176,-0.1125932221054,-0.00740124539311024,-0.261220473610412,-0.225313505027109,0.0251014930014238,-0.158293688050122,0.114449684816808,-0.195929571897047,-0.00722359665342468,0.26188661635245,0.0702235044963285,0.114050822007538,-0.135630504505079,-0.029328156012611,0.258746589180492,0.191259227355007,
                                               0.22351597322513,-0.178086652639629,-0.135768309339402,-0.211127302569313,-0.15845487169564,-0.0284790783355228,0.122457835288443,0.151768904823615,0.0512810604781162,-0.0895509456392443,-0.209325199456486,-0.155276866643158,-0.0067441225211359,0.0331390672397187,-0.26825515712421,0.197468384630211,0.05082059484885,0.16617334593639,0.0457376864401649,0.0631845924262436,-0.256505659101431,
                                               -0.158926893978738,-0.0386428885011823,-0.0399094441103267,-0.0836182140435476,-0.0543538472550361,0.148910432274436,-0.157449887318275,-0.0226963423614204,0.266495084320849,0.0999435543504454,-0.146602652930544,-0.170522665830265,0.0844380510814131,-0.0309432023855222,-0.0399363772188338,0.262154422292219,0.187761402295395,0.166022807182566,-0.0672482612678125,-0.240039866799974,0.218533963784513,
                                               0.249675197431033,-0.0897226829252424,0.0603356750042527,0.151160677227487,0.120047819458679,0.040991737766757,0.226529188459092,0.0288880585294655,-0.0434369784403995,0.191353262231707,0.259389926243963,0.204554355451696,0.197849457452678,0.0613255525555305,0.000161826529075832,0.11046164435693,0.00435365495157918,-0.137400870570454,-0.0336524178229375,-0.259069184349562,0.226307445132463,
                                               -0.119433437655632,-0.190600370959958,-0.187262792033385,0.0331953826143336,-0.0899521903552199,-0.100948869607215,0.129279719719669,-0.136807596423371,-0.152459305763555,0.0982467632644288,-0.151883280721075,-0.0747726561751681,-0.0862773663145712,0.0378568085376578,-0.0353000788799834,0.234854426026479,-0.117865633036556,0.060002687571851,0.18311826036545,0.091154996490794,0.055530705545218,
                                               0.155342291639032,-0.180182388161002,-0.0176852375335142,0.242232560736963,-0.199152687174993,-0.103622784574745,0.0904521481351669,0.205508526527684,-0.226782060575078,0.00734765230473168,0.255193446634547,0.0909545458225916,-0.169062788522812,-0.205882599381975,0.244195043359604,0.028116445008504,-0.261375746302249,-0.165232409161563,-0.182087933900756,-0.167816717061332,0.22051413814265,
                                               -0.0934597394192685,-0.0359613456821177,-0.102587557044813,0.225827785747708,0.160759462997097,0.0231290607463426,0.132709792127424,0.15273022836981,-0.246643946206994,0.112835786084173,0.175769220042242,-0.0141054457578416,-0.239074329072684,0.12175418117209,0.154890974881546,-0.216317595907401,0.158978677918034,0.141567482282297,0.205517915902666,-0.203553187750135,0.0192787898703179,
                                               -0.0660847372801238,0.0584172507180726,-0.0438391632938893,0.1646946618786,-0.153162886378929,0.0558167517277838,-0.237790810737749,0.204888565025366,0.0429180952835365,0.256763767912122,0.123914348426115,0.139082441703877,-0.209839792931249,-0.027624890715416,0.232950073802612,-0.0847602021195714,-0.250370113681076,0.0206694580065264,0.0267088673972132,-0.179844671665652,0.156220296576171,
                                               -0.0350851827694974,-0.128266607609116,0.0159648547584682,-0.174220487052029,0.0118654888167346,0.0349442167680964,0.032809194973783,0.181904377582434,0.216080957257499,0.254440057106166,0.0997690197772125,-0.0427779932936364,-0.0222515253154528,-0.188063514441815,0.0581559382397375,-0.0639085448127868,0.252314038056688,0.209888851834273,-0.157257825136732,-0.215340990157784,-0.114953323895757,
                                               -0.076711597734454,0.24671072972095,-0.0305909178212561,-0.0915266624380461,-0.0819570821821916,-0.205924183560503,-0.188843009067682,0.256232331838167,0.26061601556446,-0.140873302417056,-0.257606455879157,-0.0199086052538018,0.0243232873927149,0.0408041428946783,0.0750775681088563,-0.0692091289939579,0.0442149270456873,0.130785561138951,-0.256457004703792,0.224766985377376,0.0611652297964714))

Wout          = matrix(nrow = 1, ncol = 23, c(-1.72054644703735,
                                              -0.512322940151989,
                                              1.10828228918172,
                                              -0.274027338971109,
                                              -5.58245064601306,
                                              1.16758403896438,
                                              1.12971351375165,
                                              -2.88366651897115,
                                              -8.52622115939835,
                                              -3.76061442899099,
                                              -0.851535178206859,
                                              -5.13405395160055,
                                              3.5932534769685,
                                              1.34182174720081,
                                              4.00349374289124,
                                              -0.012918745324896,
                                              0.769339948153856,
                                              0.948145672692135,
                                              -1.15721867302727,
                                              0.382844265835047,
                                              0.675668548225573,
                                              -0.774038006046567,
                                              1.28635770235996))





#Dados treinados e validados com retornos(sem factor) 10000_2, () otimizado por MAE, elapsed time is  seconds v2.9.1.1      
#tourSelection, spCrossover, raMutation, keepBest=T, pmutation=0.1, elitism = 1, optim=F
a             = 0.716840491031578
sr            = 0.818769979629361
initLen       = 5
tam_reservoir = 33
reg           = 3.7982502739726e-05
#Win = Distribuição Uniforme <colocar aqui os valores de -Winpar e Winpar>
Win           = matrix(nrow =33, ncol = 2, c(0.683419409673661,0.468373862095177,0.925119289662689,0.0468611605465412,-0.752167217433453,0.344851821195334,-0.651818973012269,-0.417661366052926,-0.729365314356983,-0.815506345126778,-0.219655087217689,-0.411358731333166,-0.88705962523818,0.265823489520699,-0.218758765142411,-0.11445342656225,0.2591598094441,0.713639844208956,0.556999534834176,-0.259106037206948,0.390761249233037,-0.674640547018498,0.0719033759087324,-0.227945387829095,0.714482735842466,-0.0877499803900719,0.594736299477518,-0.369984872639179,-0.983895524870604,0.199343100655824,-0.299424042925239,0.351978327147663,0.64080542512238,
                                             -0.217691245488822,0.767866935115308,0.0842858171090484,-0.0811662566848099,-0.511441848240793,0.925921902060509,-0.892763513606042,0.55141113512218,-0.512235759757459,0.154423322062939,0.479527166578919,0.102158508263528,0.827759720385075,-0.738599344156682,0.507174228318036,0.590814623050392,0.0343116237781942,0.313617673702538,-0.89252632111311,-0.482800310477614,0.53110890602693,0.720491267275065,-0.713096696417779,0.760151413735002,-0.752444327808917,-0.574900200590491,0.316585117485374,-0.790012895129621,-0.71807764377445,0.0391240958124399,0.996498777996749,-0.292139175347984,0.0233919625170529))
#W   = Distribuição Uniforme de -0,5 a 0,5
W             = matrix(nrow = 33, ncol = 33, c(-0.0568476299324188,-0.0897665631031235,-0.0991160484533962,-0.0726599083941488,0.24093416014908,-0.16297883365518,0.0589596829883819,0.124306996376865,0.0587748774297626,0.00177288702477793,0.167184333136727,0.0845506198968126,0.0154434813057094,-0.0751785749965534,-0.149053059205903,0.0969046779051636,0.0513934339916544,-0.214919267020798,0.187388331779484,-0.155862369579179,-0.176250699122788,-0.180606470802976,-0.122681394693886,-0.0146593595205504,0.191573798707329,0.22122953806956,-0.0415525179501186,0.214354826325364,0.199232121446196,0.222511691018982,-0.0208913584939858,-0.0371977757656931,-0.112370979834103,
                                               -0.222369695966273,-0.214086518508822,0.0672770850144352,-0.0105629051478358,-0.0089924293783489,-0.00405511555824049,-0.184385559333829,-0.231189863116491,0.0148473468232882,0.089741603996384,-0.0676999963677785,-0.148075677952631,-0.0965119562999833,-0.141219539344355,-0.0791954603013412,0.0864961824392177,-0.0911924692201914,0.132489892229301,0.0213342408033462,0.0744030764284919,0.217381321794601,0.0184877873384074,0.244151085492951,-0.0571838499424707,-0.20069913661952,-0.186175338462728,-0.130935923148252,-0.0411461940389752,-0.162113009480401,0.00846316646709218,0.142680470341105,-0.0109013573570565,-0.0939858496836891,
                                               0.0427307637488361,-0.175786278041468,-0.199515023440551,-0.222335404179339,0.17377207227753,0.0097017879768029,-0.112146586693522,0.169967384804019,-0.173080239769056,-0.0854700475931328,0.219810965518241,-0.0194057052605519,0.0960475859191788,-0.172739149183007,0.12197301408773,-0.0936843808623011,0.234268517601405,0.0964438852372099,0.172173393256551,-0.123650370444039,0.205198538960226,0.0223285076224377,0.0559312720261374,0.241897338834402,0.0897546672939249,-0.202869030590113,0.219055829860182,-0.196912235276868,0.042469355905399,0.102928686157749,0.00598497218211537,0.0435029975248758,0.054858447625875,
                                               -0.0714644048052385,0.128802133909498,0.101519438715959,-0.0170238453963345,0.0175261246214411,-0.146509106925791,0.0933950370347951,0.197669870057399,0.139687127273686,-0.191339372714729,0.147768741849178,0.190582611887203,-0.17414201719228,0.0973905290161611,-0.0939915546387592,-0.0505387325005657,0.00401299329462335,0.176334268943161,-0.239775253499955,0.153146115038177,-0.0629783270963483,0.190303706745256,0.14390907322247,-0.153983288489266,-0.241544554208853,0.184513576529698,-0.140856874885989,0.124901761715953,0.0249428553889591,-0.234847934907954,0.236361826034409,-0.129916968504591,-0.125951139192499,
                                               -0.205531191581061,0.1743313060759,0.232238444411412,-0.109412323948814,-0.134424403894629,-0.0557204303762978,0.0432243714651776,-0.125118406051268,0.0697490811040323,-0.054215496035038,-0.0538517492009601,-0.152700299096044,-0.209599650436749,0.0256245157910562,0.184096500323925,0.144220893207938,-0.0668044004373225,-0.0117485925663415,0.165141825243821,0.187082109612702,-0.148482896119926,-0.0342841353999128,-0.229781738427294,-0.109827512420686,0.114733194051493,-0.0868182703114483,-0.188918800942161,0.160947188749205,0.0851752856928858,-0.138759036556922,0.096265430090224,-0.143389811159966,0.141238068318062,
                                               0.0416868756928148,0.102553159598006,-0.0474159406933093,0.0966009658727301,0.0639151691579829,-0.148976863442866,-0.0872912476209494,-0.235737825195098,-0.17543856748222,-0.235097190686646,0.0649461179147831,0.147091669614324,-0.127645589537336,-0.238217824166073,-0.168479688293926,-0.0609052730604787,-0.144496639203056,0.041548060893032,-0.0844861696767404,0.245893867193954,0.155234753058984,0.0440441492482011,0.211177794143031,0.028370090715499,-0.246186694100995,-0.0651630802180374,-0.0106766212424007,-0.0870862842485305,-0.22697402428569,0.171503122117325,-0.0426691615900775,0.173596571066464,0.226241605211568,
                                               -0.214907259028106,0.175805635773602,0.0669035475896246,-0.169544734523919,0.0607480579882974,-0.173318543089318,0.0487560929677952,0.132279304884989,0.134584447069097,0.181977360207661,-0.0286281486542842,0.132168821349765,-0.0716732967793703,0.0656874646385104,0.238396988087913,-0.033466869242429,-0.218655166397774,-0.0772189046026037,0.0601387569719914,0.00890729036554839,0.0443137647250981,0.11658456295079,0.0916305933664622,0.119678547459235,0.0656114971425005,-0.0828730216233376,0.230267918288693,-0.134051185470121,-0.186724816541309,0.0258976698657004,-0.0962329780896455,0.0613165859252937,-0.182602902824415,
                                               -0.190016086391157,-0.162185530144303,0.138053452279201,0.184047938865419,0.0637521416502269,0.125619007571079,0.00893243323298001,0.000886789755615647,-0.0412180399960162,0.00101965068603258,-0.239971978612132,0.0883350668527415,0.0188475625556291,0.0181640424081504,-0.143721300421913,0.0681250154631427,-0.171507237462113,0.0578227854101165,-0.0687034694598963,-0.00499497670939849,-0.0146034001456414,0.18125857693396,-0.000673709024184237,0.169795829630137,0.209981829317077,0.245701436140147,0.0134601638558616,-0.192327006942847,-0.120040741389287,0.0403072274873,0.221569885812762,0.124018516981679,0.12162976092969,
                                               0.215609519898504,-0.121098051775911,0.104956391106013,-0.187330536977088,0.0516390795954004,-0.0691618431856058,0.202548254622399,-0.219035274701166,-0.100857520544023,-0.231322922490102,0.0561804563423376,-0.13908184593649,-0.203326513845003,-0.156842167021726,0.145358197881519,-0.145388472168777,0.188886499322523,-0.0202800144304344,0.155918650363239,0.221115177894917,-0.0122024578462065,-0.00899922806512886,-0.14332945655507,0.207102266121342,0.246250585124205,0.0825346739122382,0.240910284221001,-0.010873711696528,-0.190970042400346,0.111839170655777,0.0719136719383469,-0.0925502838566312,-0.157741321164834,
                                               -0.126307504513282,-0.000893583395285457,0.227385888661996,0.0238428654918743,0.108180871170823,-0.223423774481799,-0.159936177798085,-0.154145984034823,-0.0777685014029798,-0.14351661200229,0.137761337473518,0.244602341760992,0.117697525756261,-0.202494550617482,-0.144943255341561,-0.212056700312599,0.213471500952035,-0.0298374664130766,0.0688622910042955,-0.091588009865802,-0.183462183650304,-0.0930379459625144,-0.0617207786941782,-0.0767593503119483,0.00910105557703924,0.00318797110533058,0.201836374074771,0.229224891338487,0.0653181783716339,-0.229593717859512,0.119983730494862,-0.229126414419471,0.126040379555828,
                                               -0.238732628024419,-0.238736819649395,0.136711081340978,0.142439182687555,-0.212143319046329,0.11006398811354,0.12999961734207,-0.243927120094956,-0.00838595818493582,0.0448693916750275,0.192384432962081,-0.00368198454050362,0.077705021375126,0.229266129784293,-0.101523136412382,0.143199350314429,0.14268246911143,-0.125637994225911,-0.0681243394945043,-0.222057709196756,0.116282447411061,-0.134082465049954,0.112983632360959,0.13662675261877,0.087322960908134,0.22481104898545,0.0811566482379282,-0.0595231452326909,-0.0335240374002178,0.049050430681376,-0.0513848044656692,0.00886426730747734,0.00824076808209006,
                                               0.202018794873846,-0.036200021164077,0.200101199859948,-0.179483824772569,0.132397969556344,-0.00921480344545668,-0.18414539179461,-0.113966119110264,0.0154796903062559,0.0377278628470952,0.142415869741673,-0.232527475432796,0.162585026347783,0.131373772685848,0.0627289561517798,0.205257065593593,0.026759640571883,0.115723122764708,-0.242979440855475,0.0638353018517293,0.21915836018218,0.0331421809614029,0.230741962488455,0.200662535091452,-0.0667866545686372,0.217660910361145,-0.181510311417268,-0.0298221540544307,0.0584852966174939,0.0767911417146331,0.121121589891731,-0.0125269506664215,0.165814349114777,
                                               -0.21875886478165,-0.103271711392883,-0.142529780149978,0.09266450546516,-0.216809364575675,0.211126949440719,0.174804892250416,-0.0608355478073552,0.0807650100408234,-0.022208134274884,0.00423794104378414,-0.0171370149118121,0.167308780878653,0.0441857052023281,0.210627474458833,0.196263435347151,-0.208319986056749,0.0864080840992662,0.045462122684605,-0.171536349766967,-0.0823384888408468,0.00211556871230054,0.0741118101108487,-0.156526643489775,0.206919315605116,-0.216913342959456,0.0197452495955839,0.0274142338958057,-0.15660258747084,-0.0253830107676494,0.129742792159938,0.118088358480469,0.221728695886456,
                                               0.197201115229069,-0.212016762644726,-0.0180011953345821,-0.174611302196589,-0.0761728917132111,0.21584348430994,-0.065619064022386,0.00844485165144499,-0.203422781735674,-0.198805615173945,0.00021721477346869,0.0991773036233323,-0.185830502003295,-0.032572783544977,0.156732052499078,-0.187107066884129,0.0655941409336598,0.0826277421644913,0.110478727507315,-0.0829285752794151,-0.106890029277164,0.188347840183368,-0.0577011863030397,-0.0637798742586984,0.0455264905450162,0.208027587809949,-0.242961475322792,-0.0869819711495806,-0.230175506963708,0.0681743818210101,0.034542814592074,-0.167570177136678,-0.00673032332891492,
                                               0.0946599028290196,0.172933591624913,-0.174358478111025,0.0904936653908289,-0.0456484562558208,-0.0401301164775115,-0.132906738447441,-0.187327761066508,0.0459894405084359,0.230469812100487,-0.0750487286820849,-0.130499453192331,-0.134182994536901,-0.181714309759286,-0.214547919238842,-0.0108867483820336,-0.223627659493252,0.0194744381829966,-0.0790807501554917,0.102760110384752,-0.0222799148489071,0.0114597531057289,-0.239955370522663,0.185026103453126,0.24249620701521,-0.150973520290121,-0.135934373645915,0.0276373960003384,0.232770375179209,0.148151667472394,-0.0786369068304767,-0.0367382990170028,-0.036675628362085,
                                               0.0368356328802781,0.0178518329922518,-0.181675662431004,-0.229245154912185,0.053695682461044,0.17457501129521,-0.21834729130242,-0.0311123267471665,0.138119820057007,0.239446224015961,-0.232793647633504,-0.129365107845901,0.111089852136282,0.144548918202305,0.0934660294566862,-0.029362062590666,0.19820075159982,-0.0332861278692542,-0.109227790016486,-0.0147163421970413,0.142452069336241,0.0437356229609312,-0.0127072076317293,0.240243310680013,0.123879905672201,-0.00786842751062618,-0.0288038188288332,-0.202245791405605,0.0155345028400914,0.186312099203389,-0.132990981712898,0.120785266301214,0.163858312786457,
                                               0.155133661622205,-0.202687292871512,-0.220574202591032,-0.130480217852618,-0.189941382622703,-0.226826863515747,0.0483644834474526,0.120060881538201,0.14994674629636,-0.217382352896262,-0.231972557372428,0.186984499878975,0.0682870221928718,-0.233966544183709,0.121730548392789,0.000140684983505747,-0.140138571317166,0.162748495936505,0.193921178320931,0.0898244495564516,-0.0949646714280793,-0.164176629320339,0.0658439400796413,-0.153711723221954,-9.93990489811058e-05,-0.227682775969149,-0.0763767031974464,-0.231498165610309,0.0407175506596984,-0.09166677472261,-0.00681559574601314,-0.186470123533799,0.131307173199803,
                                               -0.126346980599992,0.0822822219363401,-0.115345916779063,0.194280018216877,0.241748642940025,-0.192215492879497,0.108956587338156,0.0983184802491535,-0.103022069280851,-0.0698672168611859,0.0280094618484205,-0.0963489407217603,-0.157033411775234,-0.216588788197435,-0.211989190626123,0.0687403384848015,0.13458947020547,-0.0565061489982826,-0.158437413663685,0.213137979884133,0.123817821743837,0.244683772180199,0.116949296036073,-0.170318102179136,-0.102325052702015,-0.0255099053256321,-0.00987899751994634,-0.130542249933395,-0.185879500495657,0.187768976108915,-0.177946763969335,-0.0669024803552429,0.0681833755418751,
                                               -0.23074645108998,0.238300178321143,0.106360177115798,-0.201719683970552,-0.167313263859532,-0.012221140412652,0.121608537716822,0.209543088046884,0.141710505472071,-0.0005534067950007,0.189270697276325,0.128938623482696,0.238047186075045,-0.208866044488793,-0.170696225591756,0.239866974862041,0.231343014347349,-0.0219992038738908,-0.0702998253190172,-0.239050784312554,0.0519681077029092,0.145959288970225,0.0703635040194795,-0.185599691576872,-0.0824025411421668,0.214192358932127,-0.156435987641464,-0.169045953634385,-0.189537038096393,-0.00126934212209531,-0.00341132350885723,-0.0792638177876153,-0.228830181974858,
                                               0.0792655161401792,-0.0381317486599172,0.000920922787993764,-0.0709037824780426,0.00553605020251661,0.24619024290767,0.0518109300252258,-0.184343256636024,-0.123257052132791,0.151165945723282,-0.102850066405358,0.147106581415956,-0.0648630670290982,-0.155959613970956,-0.205784016698989,0.214348037847511,0.0344238704943478,-0.00660309199103699,0.0637134228594535,0.187507559318328,-0.0994153444938666,-0.0413265822291468,-0.200482550555385,0.198617504446423,-0.021498321780638,-0.142168962819219,-0.0549661011087919,0.220017585604565,0.134535720776562,0.0444518125935529,0.0837922841415076,0.185487686337939,0.00250602198559168,
                                               -0.045826368609052,0.191704256066246,-0.174819311041153,0.0545797341594057,0.0308094130757923,-0.124721016098617,-0.162862096635779,0.158603892706539,-0.239125825778559,-0.179838068127657,0.218585601160984,-0.154027513677208,0.0509616494745544,-0.217920659081829,0.0360155591530688,-0.00587620512316915,-0.223917135119157,-0.108378836266197,0.119252442317533,0.0130386176311056,-0.00750413925927815,0.173967480896908,0.125360266666526,-0.109300451655351,-0.117274485357488,-0.0928329687105426,0.0847201652884932,-0.152245646352289,0.239085315378391,-0.194786212164144,0.225354462846484,0.0663741586153212,-0.127756504256356,
                                               0.144067874693136,-0.230863108043861,-0.163454547416036,0.098460794990408,-0.0716517055862894,-0.015389706411837,-0.242401650438999,0.0782181121984064,-0.0142137213743435,-0.0848778488242616,-0.125089612287888,-0.0647803247053744,-0.121970893383812,0.0457553803166146,0.00604564750791996,-0.228363437616973,-0.024630995370731,-0.0552937078812595,0.10415384748353,-0.147825538126715,0.156899355023834,-0.0604927365008675,0.0664115481808136,-0.148001191209913,-0.238607703445292,0.242967521646039,-0.0316841589354094,0.195225131803798,-0.122285036531139,-0.0743731402976138,0.0211285886150995,-0.091769892803526,-0.190215842751805,
                                               0.190456067071012,0.189117356549422,-0.217908698119027,0.113414105432371,0.108239846423458,-0.131921852026676,-0.238721262850028,-0.236935538500595,-0.135630734223043,-0.0151839090044665,-0.0990126413107174,-0.242811888842888,0.0263323778066451,0.0763450616021674,0.146895816275717,-0.231571334942571,0.135842210202863,-0.168179295654069,-0.00796618464291135,0.0811754510173608,-0.184674941588196,0.165640564379989,0.0076033269031684,-0.0208608212981722,-0.0467257316336963,0.220923417418517,-0.11040245821706,-0.0527375508858667,-0.191272497014111,-0.0891658499741441,-0.0260358620356225,0.0111727576756322,0.106786965452683,
                                               -0.105933975276054,-0.190840959575994,0.235710552332478,0.0411548156501741,-0.23829905751857,0.144220201524434,0.16550609089788,-0.0648378999584792,-0.122281406970702,0.0703555529856877,0.101801098891803,-0.0893885612799752,0.023008589770251,-0.109600480215035,0.0277043188455537,0.211751853253918,0.217551980762311,-0.0899001454261701,-0.0397354394612709,-0.0781348698666571,0.203233868288224,0.091383173359379,0.0820298681496756,0.043714073521216,-0.14959989133699,0.0350872395957428,-0.164853249838835,0.0413976885551374,-0.159689211227966,0.0874187282172443,0.224798559796688,-0.24095618745836,-0.0949215192098714,
                                               0.132853183217567,-0.147941755064356,-0.0122942784298902,-0.0929281619108739,0.133367922954674,-0.0619673902459817,-0.224070467701859,0.0427774217585753,-0.0135921122917057,-0.201885172632747,-0.231278106102031,0.18542725877936,-0.215393251114067,0.179876932596383,0.0176978874150813,0.159490575325771,-0.242989216878413,0.230241751890265,-0.0430030141613501,-0.0751472140894227,0.0435671606332049,0.220731907806433,0.0175464251308094,-0.094166450196608,-0.0718515648391597,0.0526632150976253,-0.0494425637246892,0.167291870994939,-0.21865285975373,-0.0594968715831726,0.234069459691977,0.195983871786743,0.111278056808878,
                                               0.091357013269839,0.221700292356457,-0.0220099321947471,-0.103561179792244,0.224423578668962,0.206846673351742,0.0651287397953151,0.008096224238757,0.0256613570568556,-0.0551321174234104,0.218079398725395,-0.0333594875005106,-0.0566553525860574,0.182103250390725,0.101187476746264,-0.224362910799116,0.0895154081198257,-0.179963464611583,0.199044580812706,-0.233842030944059,-0.0540729647268754,-0.0508549142215628,0.0838174055587211,-0.0427734487652344,-0.16176889819893,0.213841391839765,0.110327299405744,0.152598747684,0.0823823282689838,0.0674060056430202,0.184375207710921,0.0118281299751229,-0.0559224455481495,
                                               -0.174120691775432,0.220369359775722,0.148954576436827,0.11365670407278,0.122768230682766,-0.188733376539014,-0.0804098567147174,-0.118202126193206,0.216031239789732,-0.141585653731919,-0.173371007913986,-0.104375560493916,0.0201846757815652,-0.0985408546603824,0.0654794524674425,0.208666645670016,-0.11145580237806,-0.0316820576169832,0.190357597837368,-0.13748764484928,-0.118130024439447,-0.0551631496948464,-0.113858599261059,0.179723755671146,-0.0853389807956655,-0.0187295354260506,0.112051866774474,0.00456176638368237,-0.127290264609485,0.103444708319661,-0.140669597849297,0.23155247538315,-0.157882289704165,
                                               -0.088504442707404,0.137399113260805,-0.209746008372058,-0.049724301557206,-0.117722519504529,-0.0465111796696575,-0.0345238399814824,-0.116587184006854,-0.148107831944297,0.142904971650432,-0.241067913270922,0.225012727033286,-0.207332213950759,-0.0583714186712831,0.011460560184524,-0.049749626350017,-0.0547887763997715,-0.211008883998986,0.148270430677104,-0.195259889186643,0.168491769584422,-0.119656941813066,-0.241480959818072,0.0372328114278379,0.0266789598779466,-0.0383050648164116,0.201828864318995,-0.17032300785549,0.111999310298874,0.237311533409219,-0.00457807749660183,0.0496483426642248,0.215967235894786,
                                               -0.213037556042378,0.0973791763448383,-0.141961055834514,0.159533507306445,-0.0104031068729164,-0.130889906809744,0.214060500541316,-0.191198153655204,0.11043729738603,-0.0811529874771741,0.239140342529115,-0.0617619184919227,0.0461312238119335,-0.133945469389258,0.0953577871666792,0.214018665045321,0.215383916827974,0.068691308448001,-0.211687242558685,-0.173659797362326,0.0193235946285457,0.215947426790415,0.0187299699363513,0.0748419552324366,-0.156891751781814,0.0142856671265169,0.036951649883534,0.209194190154975,-0.202119359575857,-0.165015648293135,-0.165052809247479,0.245465110139992,0.155141464110369,
                                               0.0953754979350076,0.00786572788023364,-0.0599183027567587,0.144376278702692,0.161138263277454,-0.13997511469034,0.0761305549474128,0.0532450951645113,-0.133104068524594,0.0316666743693811,0.0191100975105273,-0.203566075501589,0.165591781307464,-0.0977495025458189,0.056644969877539,-0.12498381361795,0.0218883569467365,0.13375647541746,-0.0894837934807031,0.0604844201251254,-0.0234256368404336,-0.131913215847682,-0.172966777291776,-0.0276064131676404,-0.021634977334935,-0.177596659359273,-0.215303809210453,-0.12972634844567,0.217175323879309,-0.066617161942199,-0.156851617047231,-0.215573043974655,0.0445460775844456,
                                               -0.235698688641253,0.195327236103817,0.123807698961491,-0.156506797335027,-0.140941807311395,-0.0208668746185493,-0.115560880541407,0.0885734605621578,-0.0111450379143502,0.167413722801644,-0.198163702943677,-0.0659462378904516,0.0542619974696556,0.099328821999351,0.113680863212562,-0.24238659628592,0.196995325507071,0.131213677090258,0.0833237240857472,0.190494659913446,-0.146487791488455,0.245803826060718,-0.1646930428627,0.0291622644766527,-0.138320928469638,-0.211298710169632,-0.142976370135276,0.0934153877858507,-0.201457273587509,-0.213533213114853,0.198798098191626,-0.0080135436274255,0.195414938589743,
                                               -0.152872049157202,-0.148467971471105,0.0800304606273914,-0.180107520491131,0.157095546748235,0.164634869297629,0.00543559412808119,-0.233294259362243,-0.150227885931618,-0.0398401580496383,0.121304950715071,0.139596179151815,0.0535475480576707,-0.159546105237489,0.199327747895051,0.226395451681848,-0.048879428051348,-0.209125130546856,0.203062474048332,-0.0835441328769886,-0.115213415111123,-0.215363940824846,0.0608307745029352,-0.233061923790899,0.110891077553265,0.0856738516214099,0.15992740098825,0.00905239627342036,-0.0829917012066094,-0.243428298828541,-0.233414154381403,0.00984074019563009,0.0648214478705969,
                                               0.2257291525036,0.111027724963362,0.165391448199775,-0.201370658180284,-0.124409758751223,0.0662256687348038,-0.0103046961398674,-0.109202785600463,0.120124253397308,-0.0781042372345789,0.185489592424968,-0.0134132271079939,-0.177431886239649,0.245415611754311,-0.120750438373534,0.0939951613724933,-0.167945323327847,-0.2051002213693,-0.203865155548687,-0.218623527670171,0.178375444972524,-0.18412365561182,-0.134640745173921,-0.234306759210855,0.206973121928719,-0.193640470787126,0.108752921531872,0.12166780627538,-0.0724062795239304,-0.216528472592935,-0.232858272667118,-0.203514649808076,-0.0211063899334884))

Wout          = matrix(nrow = 1, ncol = 35, c(-0.149819563284836,
                                              -2.05041247559416,
                                              -4.55734848649547,
                                              4.20318996209335,
                                              3.14046896022205,
                                              4.00042830441294,
                                              3.65289331216513,
                                              -2.66380839355998,
                                              3.37951140693113,
                                              -2.05796245868578,
                                              -5.18155401048625,
                                              -0.477002530075879,
                                              1.10038837381035,
                                              3.36730289360605,
                                              -1.84119641244638,
                                              0.82339939473502,
                                              3.35916953386118,
                                              4.7526863221691,
                                              0.79285823783971,
                                              0.536007383253377,
                                              1.41750195166912,
                                              -2.52888019684269,
                                              2.44555058074957,
                                              1.4464881815785,
                                              0.746926095240781,
                                              1.60594917644198,
                                              0.0525991519241416,
                                              -0.180493241846307,
                                              -2.66364323112111,
                                              2.07494442312956,
                                              -2.06653036443254,
                                              0.297227621222987,
                                              0.763286222915212,
                                              1.43497382632404,
                                              0.102899308689302))




#Dados treinados e validados com retornos(sem factor) 10000_3, () otimizado por MAE, elapsed time is  seconds v2.9.1.1        
#tourSelection, spCrossover, raMutation, keepBest=T, pmutation=0.1, elitism = 1, optim=F
a             = 0.972785742078721
sr            = 0.829702985404857
initLen       = 112
tam_reservoir = 32
reg           = 9.49414068493151e-05
#Win = Distribuição Uniforme <colocar aqui os valores de -Winpar e Winpar>
Win           = matrix(nrow = 32, ncol = 2, c(0.814807757269591,0.604995729867369,-0.784183159936219,0.330424879677594,-0.536269585136324,-0.278537082485855,-0.547753590159118,-0.242363428231329,0.640423906967044,-0.165597090963274,-0.775678164325655,-0.896097023040056,0.119730591308326,-0.93377059372142,-0.532795077189803,0.0580075816251338,-0.714956343639642,-0.651232646312565,0.810106242541224,-0.950003038626164,0.816043341066688,0.311522422358394,0.0262450217269361,-0.284503704402596,0.631797662936151,-0.0618741232901812,-0.665285948198289,-0.873007675632834,0.874653504695743,-0.146455869544297,0.122442386113107,0.638506032526493,
                                              0.631066357716918,-0.605025369208306,-0.511235442943871,-0.709522290155292,0.353392370976508,-0.220777010079473,-0.529598305467516,-0.513208621181548,0.119082778226584,0.175042769405991,-0.824961417354643,0.880954034160823,-0.704844719730318,0.276299916673452,0.36216693231836,-0.236952336505055,0.466561111621559,0.0187633917666972,-0.361512164585292,-0.580910976510495,-0.393189061898738,0.317190990317613,0.335809207521379,-0.170032426249236,0.630448573734611,0.119623269420117,0.226627861149609,-0.922109567094594,-0.720065623987466,-0.759547662455589,-0.26609848625958,0.682647103443742))
#W   = Distribuição Uniforme de -0,5 a 0,5
W             = matrix(nrow = 32, ncol = 32, c(-0.0742862131145695,0.208685553352465,0.0351145027678175,0.171887120371145,0.214275323225095,0.115533350368321,0.0942678347888134,0.203225950413696,0.0445050750502106,0.256513097628034,-0.131526891985697,0.115408144365234,0.0453768864314494,0.0398260116905804,0.129695457042746,0.118214655511786,0.192760195245822,-0.242286398559054,-0.0820242179487389,0.0644269520558207,-0.0168920818959276,-0.0503951028074162,-0.00438261833886249,0.180459948125776,-0.0326888922447886,-0.00210065162619317,0.0246303464916048,0.0733910881081199,0.174137527793953,-0.223371407962418,0.117245992775581,0.039698679181528,
                                               0.168848210656913,-0.10243816537446,-0.0745928105905128,-0.155100322575717,0.0250267112329079,-0.069509629929494,-0.229943132996758,-0.0666912500847986,0.153998170396977,-0.0499437093897686,-0.0486963392913564,0.0415102741071337,0.158333648058967,-0.137160056494532,-0.124058481702293,0.208882854111924,0.128140738156345,0.241177792986388,0.200073627366761,0.250852175336797,0.225795412339281,0.0439532133406703,-0.116022144302851,0.0411104701856283,0.0137705981464191,-0.120835493364292,0.197368756009007,-0.00202131391088932,-0.224513224276961,0.00371889720358664,-0.0989135819718448,-0.105197901996695,
                                               -0.049335370770719,0.249331099092101,-0.0170764908100998,0.229616248063377,0.105492678590695,-0.189083560151737,-0.0793319364769677,0.154717046204285,0.238566552682054,0.21979114928889,0.207676599490532,0.123252584953086,0.174343569593898,-0.101781080171454,0.249663771220198,-0.217734038975096,-0.0509523164647089,0.204643577145955,0.052530165003491,0.24522554861748,0.071291099214462,-0.186538278470339,0.13081412959913,-0.0918384115215178,0.203350037398157,-0.150601268561675,-0.225766015895697,-0.229340617912736,0.204569716417767,-0.0518290312777419,-0.191796621229187,-0.122644846307809,
                                               0.0194859363493943,0.117150844394587,0.0300598755507724,-0.253210897809498,-0.0585757930119263,0.191545252301306,0.0418906217363017,0.125585022501892,0.0484931871439328,0.215516138081076,0.17763571043793,0.0185733815011735,-0.203305421655739,-0.0614103151276609,0.0828942760294554,-0.192082189259805,0.0364581243669636,-0.0371245609842512,-0.107734647649566,-0.0202126360824667,0.0946065288891682,0.159763087305333,-0.0332119301097429,-0.205271442944859,0.0515801428152476,-0.251679817937549,0.00245210607728472,-0.12929540937816,0.162162982156332,-0.116661829549211,-0.0514620417018136,-0.17207600978282,
                                               -0.0129812192645042,0.105138115727967,0.18294870173433,0.25558927811982,0.148550699025912,-0.106446983317373,-0.0874887579101823,-0.126210317940952,0.134510867341039,0.0223223565291975,0.0338779180915316,0.0816503618469156,0.17008806954751,0.153082591532712,0.194578512172857,-0.0215240106752515,0.135219689433625,-0.115354663140669,0.243890230421046,0.21399727548737,-0.0820785188625157,0.0780723415692615,0.238599901254128,0.157153686729304,-0.112923840532274,-0.0358478269572712,0.184525075621497,0.104762282426263,-0.00873901427351299,-0.139801047560493,-0.0884020710037984,-0.242030615837268,
                                               0.0999305060771145,-0.0460105121698343,0.149189881484926,-0.163483905524765,-0.187237346775319,0.0706096903885552,0.226846338305461,0.0465337613823935,0.114712649484438,-0.222298024400552,-0.12398434053209,0.146887609622825,0.0173583752001917,-0.144042201073241,0.195682020060415,-0.095941338679853,-0.247193598030733,0.127193071394125,-0.0144063955770784,0.0404693560716642,0.121395441869157,0.0609130299922918,-0.199899928803281,-0.0317990563077881,-0.244805788724345,-0.0980184668872567,0.183842082047173,-0.250104789120095,-0.0514510289136552,-0.150480896895973,-0.10226750911672,-0.2248767921256,
                                               0.0327859299633951,-0.0590755503643884,-0.114189370864916,0.180396411752004,-0.194475187938865,-0.192493184323896,-0.0345258027403688,0.14868401955772,-0.179116940606181,0.249381254102236,-0.00707653596146537,-0.038430967951993,-0.233207826146447,0.229419749540217,0.179122002309598,0.0636493859270943,0.179182948718885,0.170979595548108,0.0140217544117503,0.163074572790875,-0.167104690101563,0.148020938800906,-0.132161245845271,-0.0463906947135709,0.0384113294799326,0.187990760224061,-0.0968803351695639,0.0537043629269989,0.195451522067155,-0.138297494877321,-0.0975830714552642,-0.106778324122914,
                                               -0.242804302757209,-0.0703656686589214,-0.256390499759589,-0.172101012395764,0.0800010401623642,0.0874155822686034,-0.012215810404689,-0.0126197795953974,0.0138117745890943,0.249857623833917,0.140228934534102,0.200550904291302,-0.0548887384091875,-0.184372310751401,0.0156528336182073,0.0252568335103747,-0.11563003532291,-0.166880486274281,-0.119259415698485,0.0566497663880931,0.195641578194116,-0.157951900849618,-0.0399497106465766,-0.174283779499874,-0.0510053355456978,-0.122865594936461,-0.194221056430014,-0.204595130847735,-0.183358072123477,0.0409024735398773,0.192699184284665,-0.253828345773315,
                                               -0.0191558670961579,-0.242127925390973,-0.121137674894602,-0.0485300209193022,0.216176308983024,0.114246244051185,-0.255294588073141,0.0455390463481091,0.199580566314521,-0.0302615786282477,0.166801916367613,0.0855037104354465,0.00960166789608167,0.249172964104097,-0.24395052198747,-0.0379860050960347,0.202897167894408,0.00755047244625694,-0.117681343858048,-0.0838633326516096,0.150414375117738,0.228692857944641,-0.105731030753467,0.0556025294417618,-0.120542027053718,0.161545985099284,-0.113507316878927,-0.0939843906342696,0.145345436870583,-0.221050900436031,-0.142894843817414,-0.197953131180685,
                                               -0.23169091660544,0.0735752193297092,-0.140038205872285,0.0499365503482685,0.0850947847369616,-0.247810633340742,0.00748835848490129,0.18427686722491,-0.195572558617122,0.191224089054445,0.248043289996362,-0.254269753733866,-0.0919527150723287,0.121912138827797,0.0482193772364946,-0.23252474315583,-0.191903718878622,-0.232727032101298,-0.0757192916519359,-0.0232681789010333,0.0887850611952727,-0.0567752237848531,-0.171637394527444,-0.0735850649244198,-0.25504839393399,-0.177975546030525,-0.149579719075816,-0.189077810373199,-0.153193201760216,-0.0364011086884181,-0.0457257176857957,-0.253052054424487,
                                               0.186625530842647,0.232578132453749,-0.0530076868665172,-0.111285643167168,0.153751905250768,0.141554113544356,0.0192338903441171,-0.170439299979704,0.0156180384865352,0.179258264135424,-0.0780637280784907,-0.143902568922541,0.13483677072737,0.239388040979214,0.141753785987348,0.104950007513463,0.069499702090919,-0.0530152709940373,0.134954997956032,-0.161623799749069,-0.0989147742687978,0.20794721192866,0.168631056252492,-0.0391053422976015,0.0880283063504581,0.221155054998341,-0.0357455885096456,0.216717739827563,0.228095709392312,-0.217983755614178,-0.250402786015642,0.174174064750259,
                                               0.0850974348303195,0.222202353866651,-0.0838133935316187,-0.147722739403752,-0.187136415144446,0.212030924864172,0.249521355927563,-0.102736179483839,-0.163828783216135,-0.0165594721679724,0.213229755900936,0.0158736062745006,0.141774480002028,-0.22341835773311,-0.00211937453755941,0.155953010584913,-0.0208796815195238,-0.0181054868323633,0.254365206943137,-0.206577024246363,0.171344886094902,-0.0729991059606498,-0.0117833077332705,-0.143537082209787,-0.238538026732395,-0.181002996711909,0.174536170020873,-0.000395190973127701,0.0154299743824761,-0.176487713520884,0.096579263692342,0.139926023806738,
                                               0.239146683209636,-0.226916055042655,0.180800323682812,0.177766611111384,-0.180027396323212,-0.107070509676564,-0.223059749978463,0.0578066614218414,0.251893085123972,-0.0255053344225661,-0.00627859534981642,0.205534747633104,-0.197201986730185,-0.0708417408542967,0.223050520495492,0.0937687432769397,0.161970561279188,0.0829345547229711,-0.0724385402681797,-0.226088383513101,-0.027073106055769,-0.161082317263034,0.129205547078102,-0.0403868479032034,0.0631009911311525,-0.160185652814018,0.112134920088179,0.25457309432887,-0.246942714795905,-0.166989757648179,-0.0464848236531762,0.207631000647037,
                                               -0.234193721004435,0.154377175347242,0.0593742116660372,-0.178660520630024,0.13612265055897,0.207151996720884,0.247012418144563,-0.207876532412274,0.0141286786079185,-0.163142924016931,0.159327374612852,-0.0792789257638139,0.155843452911516,-0.143718682878519,0.255317512594023,0.244553486782856,0.0318852330546719,0.235993294220058,-0.0791346803061149,-0.0699700009582773,0.119008196076689,-0.205148372413274,0.0416099142224383,-0.227393692620885,0.0911042460060209,-0.0722179303065078,0.0225619715178171,0.21495641395373,-0.136609024276525,-0.0618885756314403,-0.224128547966726,-0.037570442150335,
                                               0.0699266418256015,0.00746112464851371,-0.0639844120467287,0.227047790586966,0.240732059213741,-0.173329164087435,0.0197857214512893,-0.150634063541691,-0.128645196678074,-0.220969121584164,-0.138959084844552,-0.0953309641665376,0.190630811462607,-0.231563614937837,-0.0729992894553183,0.220686043343093,0.117682405616775,0.0549717040591441,-0.0851873694523802,-0.082870568279214,0.121050079321517,0.117868355049378,0.0978276293240432,-0.170068270413017,-0.236399317714269,0.194691236474115,-0.0323478319597649,0.0339446568357746,-0.0412317136602016,-0.176565406119819,-0.0909998661098675,0.000655005556917482,
                                               0.194211959039297,-0.23280357531832,-0.164205830332081,0.179011485682306,-0.11870998376916,-0.00161198297010745,-0.158894077714348,-0.027528460926066,-0.0677227309954481,0.142717705117408,-0.0414835783225393,-0.0630683709193483,-0.0190305328261135,-0.149248110619094,-0.0141108552388192,0.211177202471024,-0.0378941997846801,-0.177371728791829,0.126952743824581,-0.0610717080527906,-0.243512066796824,-0.126944042710624,0.098218086971509,0.0391730596003823,-0.147181858565056,-0.221182660007982,0.117715500762988,0.0368741398929987,-0.019076026234887,-0.0180352428020212,-0.221236158446379,-0.02654327099841,
                                               0.0684958037162974,0.20099188178651,-0.116533309524826,-0.0240550983566888,0.017284028061707,0.0984195537174146,0.14111163928254,0.238698301614901,-0.245313756237929,0.210340237743413,0.0584532667482411,0.234525085359455,0.110079989117251,-0.188095222124998,0.139660073089512,-0.206859064278186,-0.00401556911222444,-0.0602608941246318,0.0285204499587747,0.208222362960975,0.17901211458488,0.171779185101423,-0.0801389096883827,0.255749544873571,0.19093325143948,-0.102566107300985,0.0144292313989083,0.049757641014367,-0.150991404286573,-0.204980008583714,-0.0316855506898188,-0.218269245226228,
                                               -0.171660080325946,-0.234551938578889,-0.139232344746147,-0.170876748519794,-0.250786186470114,-0.135063136085984,0.12180765277968,-0.103987523586653,-0.0304433703226998,-0.106754086927796,-0.246243450085883,-0.0526945879413677,-0.228909813194588,-0.116975147592099,0.0393845156286802,0.148414058256699,0.202192424045541,-0.0845003320620025,0.177382099049797,0.0544199158670116,0.0456086808414386,0.154100894418116,-0.255173804470874,0.146430463557667,0.136187564637012,-0.243654971368728,-0.0273404930521099,-0.117218832456602,-0.0736137174674685,-0.147387798636035,0.00358942719084295,0.040194749785411,
                                               -0.219233071592859,0.0307582741898678,-0.0050936344777964,-0.0237766786089258,-0.174493022116262,-0.0400865292920543,0.198050026526555,0.0146778890286959,-0.211487353049267,0.174851713190639,0.199195392835344,-0.0513088780446077,-0.123412121314379,0.233951644437827,0.15741692471395,0.0398866689313958,-0.0280734296912606,-0.0206031390357823,-0.213241904443391,-0.0578818987784341,-0.0752704727780498,0.218720158210603,-0.212758289242427,-0.110479374168842,-0.146961149862931,-0.200779931458242,0.180207740501742,-0.218304718869781,0.224618468690015,0.0145446132050346,0.159087612708957,-0.091631028835778,
                                               0.180732754968874,-0.157687181160467,0.0221600247132979,0.134992743227718,0.114905265212598,-0.209705277215799,-0.111356838978976,-0.11991373055039,-0.22439070626157,0.127400814016312,0.0564906560691442,-0.102213312800882,0.0638528083555898,-0.0215832747910728,-0.0401697706024053,-0.144076919579452,-0.204700256437531,-0.174813705886175,0.228019048069277,-0.0446553002823713,-0.0859343426566521,0.220291457005817,-0.248886688274175,-0.0542485044719293,-0.0976028582770858,-0.0185631078319302,-0.186804104028661,0.0492081555308976,-0.204714185894364,0.170180214114806,0.236658533758772,0.145902644789932,
                                               0.0841368911653751,-0.0284282935569698,0.0169887290757186,-0.188493928545167,-0.18485180335912,0.0813672825299797,0.251774215843281,0.172434972572755,-0.00882661522592093,0.0035994309376358,0.194330888687941,-0.00938524735079381,-0.185092351122266,0.118741171527146,-0.142644142642769,-0.0280586843705114,0.100861700397432,0.240104651852657,-0.251636653536349,0.0842228881233459,0.218795501001918,-0.0294896840985724,-0.147473160594866,-0.013490469328119,-0.220008342424434,0.195482752501099,-0.175416031618044,0.181936320765786,-0.0935112092868204,-0.0730815353519207,-0.166158972805828,-0.253320290158382,
                                               0.178166346655724,-0.250652409532674,-0.0355304758569748,0.188452590842357,0.0899839060987351,0.0545260978362116,0.0409864147598594,-0.0411133229001347,-0.0701304705722585,-0.25059400909697,0.0884660685648221,-0.0758262604367109,0.221640085200209,0.191586082793772,-0.02559671691917,-0.155702765218196,0.0134943359851515,0.0535711802253875,-0.0229469831391566,0.22686144906152,-0.233076347136051,-0.0884124839377249,0.0538247551536674,0.0580330150654862,0.0888651631329969,-0.083455548923527,-0.094530411714491,0.170756556284383,0.236562928852606,-0.178157597725566,-0.187088089821213,0.22331871630286,
                                               -0.202758607543837,0.175059145007524,0.00902939333111812,-0.126284445722619,-0.136766945047952,-0.102603875883069,-0.0415653488065709,0.0194254158629117,0.0962559353279345,-0.0176935702305534,0.116326191860376,0.0238508086618615,-0.0351638351002273,0.0592152945245373,-0.109195091996032,-0.0740438428369515,0.194185703880988,0.0965095677551952,-0.00909025128043395,-0.227243569476312,-0.184505031309437,0.208694730715777,0.0365950786909095,0.196919422752347,-0.114763199456387,-0.21064219142953,0.187700841875545,0.0880037130441883,-0.0534470533143992,0.238566766061848,-0.252455441533141,0.0838364099791451,
                                               -0.210003981910649,0.108293093052177,0.0135773065362686,0.214179802953603,0.158205871576496,-0.0973084097022187,-0.146395128102932,0.137336798439617,-0.217559618984694,-0.185466855253143,0.23877107356821,0.065579176761751,-0.184434024849782,0.152357663509399,-0.0519445117047811,-0.125652305155413,0.216296180252191,0.202366400062523,0.0800395108058083,-0.0688025524109739,0.0248280798681361,-0.130065674451272,0.00413187520550137,0.199445216702256,0.0698782251734263,0.0637706303579916,-0.240397339237329,-0.0715172625496299,0.139066887543859,-0.0424421500473858,-0.0213713511203366,-0.071325162877811,
                                               0.0294047264257137,-0.0938703097874114,0.0924644783554281,0.191239912989131,-0.141415103601962,-0.140390192398145,-0.122193621442267,0.232666002730905,-0.167886385159181,-0.131037313745942,-0.12355042130574,-0.126688025569916,0.0375289731920548,0.182280055291348,0.108094020702498,0.149448796885071,-0.24975266990428,0.250141342094829,-0.00944715725651494,0.0729088720091756,-0.120386813276927,-0.211956644309746,-0.0624126918712504,0.205606413717241,0.0737194590494642,-0.20264057982827,-0.237269787970631,0.171622692958518,0.148139978068189,0.0355118219204774,-0.0982368327151109,0.141003822955615,
                                               0.0516680485959321,0.100576030279227,0.111384540218721,0.218852083943851,0.0139813534283024,-0.0277360999066392,-0.17966069244908,0.184517983044515,0.173328558256178,-0.0399024099049745,-0.15982294242939,0.136910906477422,0.0915247896066782,0.144551080680844,0.151917537740257,0.0582342699856248,-0.0132464680399108,0.137179714332153,-0.165540145464174,-0.118300697536526,-0.0400481750810577,0.254352634629608,0.2146345512754,0.00789549011955309,-0.234534965979533,-0.115191228922273,0.0252506339009325,-0.0236108639805412,0.04203073826511,-0.251854520999856,-0.198286538004698,0.178083137860389,
                                               0.159516808411967,0.148553234240848,-0.197330596290405,0.0660950720817942,0.184397486937152,0.129613210667982,-0.156304045927009,-0.00611757477366792,0.00888218314946363,-0.135739269111437,0.216818126951456,0.182821710513407,0.0750826018514396,-0.120953082485762,0.216191459546071,-0.165596082289702,0.0959351358428173,-0.238686856926914,-0.199866017314989,0.17729233250168,-0.102497499182394,0.0318805734854989,0.157110500213111,0.155280811159172,0.225047473486845,0.0635461627048248,-0.228504791210691,-0.100869657610855,-0.20233688694741,-0.177689008048285,-0.108719883839396,-0.0917703860433264,
                                               0.00299762711959211,-0.220102680798996,0.0704537843527249,0.158822633138758,-0.12346906443184,0.000396190212172231,0.217846777979835,-0.245476891724614,-0.16877103184305,-0.0296318764481736,-0.073699053605552,0.244982065178721,-0.202002250051646,-0.190859107639386,0.135270113529427,0.194487911112506,0.0444872226327697,0.110206668576548,0.225731714227211,0.153585188689306,0.0116519657162874,-0.024247250865409,-0.165854348226306,-0.155193906769261,0.230511269189132,0.0311154957528704,0.0462211057134203,0.0584983429606675,-0.252624786909751,-0.0940770971614583,0.139332627511183,0.101098903536912,
                                               0.137800780667383,0.0180223307543892,-0.0504219779027614,0.00745086843218358,0.222316661242758,0.0146773365125021,-0.0887676773765942,0.150814223986472,0.247227227762065,-0.00328197332675337,0.222643320603215,0.131043314081369,-0.0560667040101933,0.101734417058882,-0.0505520759812953,-0.140728417660656,0.11705498630164,-0.208741741930286,0.231013230031641,0.12253019465506,0.0439737005502849,0.0736421642813157,0.198962979325102,0.101622454469694,0.119274738878015,0.181882501361145,0.0606587788234001,-0.189194596541126,0.199059250310938,0.0799180685353826,0.066038989177775,0.216856402743884,
                                               -0.231618667641822,-0.0425421958831494,-0.178227091161104,0.239751351457155,0.0521679183164647,-0.0622437928588693,0.114037355155137,-0.114013295955824,-0.112474378650035,-0.0700105200477397,0.105526136661868,-0.193903202183751,0.0850202398784889,0.104936308291634,-0.153534772483178,-0.160112483627626,-0.217693002155725,-0.224095280084489,0.176055957379892,0.0053525187974105,-0.153328287546597,0.246288281359824,-0.0615998891477832,0.122026088419186,-0.0310223009027368,-0.0428966988560873,-0.0217347114466666,0.100772335146776,0.118428203857466,-0.152620625355489,0.142540177552153,-0.237824327746007,
                                               0.0535017423761815,-0.182080873681652,0.0909459118635424,0.252920365142349,-0.115396638831132,-0.0392668723553635,0.225886487616798,-0.0377337883869227,0.157325556801287,-0.117577708340592,-0.120074403980925,-0.172458182675892,0.0682443595974407,0.166014004367181,0.218189389900556,-0.134444638795653,-0.240608693656201,-0.00131476021884287,0.240966401270879,0.10347678859094,0.0631547009171538,0.203864764090267,0.237698390872299,0.174057011648394,-0.135924271663735,0.13474034840326,-0.222642628105095,0.19357311033736,-0.101394993641933,0.173226934844428,0.181719706803968,-0.0999938926666396,
                                               -0.239395985879965,-0.000152567389188951,-0.23199037799166,0.0891557946601393,0.143790922039816,0.161481281412523,0.22881470928266,0.179859602104137,0.236350961788668,-0.16042178200164,-0.0421776328598429,-0.10632933609922,-0.062147888981911,0.0420596867904382,-0.0270273704579413,0.227920996169063,0.114668504372971,-0.166865939390763,0.0194766270133695,-0.213997665428483,-0.0114551794591424,0.131473375496685,0.025253308021931,-0.0691080302705885,-0.16453620596762,0.109677078099054,0.11867335990691,0.0332566408868589,0.14109148284149,0.0280022490610963,0.244082976448352,-0.218296483963776))

Wout          = matrix(nrow = 1, ncol = 34, c(0.663699707703543,
                                              -1.31389782125171,
                                              -1.07287710986247,
                                              1.85998696822388,
                                              -2.22208682559108,
                                              1.11563532631806,
                                              1.09178091461342,
                                              1.08255483815762,
                                              -2.53239031091971,
                                              0.932259697840891,
                                              -0.379589554880882,
                                              2.88317346114397,
                                              -0.761082287171348,
                                              0.0846616137652063,
                                              -0.549432157184924,
                                              2.95329440533158,
                                              0.101402873778255,
                                              -2.02923617657277,
                                              1.21677776153439,
                                              -0.550460752892718,
                                              1.04335545931377,
                                              -0.454840232518791,
                                              -1.29626088386163,
                                              -0.412879857071744,
                                              1.02859144524757,
                                              -0.225568827818861,
                                              0.746700158970043,
                                              -0.0608564984881355,
                                              1.31213885077051,
                                              1.29333935648015,
                                              0.704503213081665,
                                              1.26260116368904,
                                              -2.34096322835359,
                                              -0.86211328003742))








#VALIDAÇÃO
#Reprodução para verificação do Algoritmo Genético (Dados de Treino x Dados de Validação)
treino_valida = data[1:(treino+valida)]                                       #Sem factor
#head(treino_valida[1:treino])
#tail(treino_valida[1:treino])
#treino_valida[3118]
#treino_valida
#length(treino_valida)         #4453

#Para cálculo do RRSE
validate          = data[(treino+1):(treino+valida)]                             #Sem factor
#plot(validate,type="l")
valid_media       = mean(validate)

#ESN otimizada por treino e validação para teste
tic()
rhoW = abs(eigen(W,only.values=TRUE)$values[1])                  #Autovalores da matriz W
W = sr * W / rhoW
X = matrix(0,1+inSize+tam_reservoir,treino-initLen)
Yt = matrix(treino_valida[(initLen+2):(treino+1)],1)
x = rep(0,tam_reservoir)                                         #Preenche o vetor x (do tamanho do reservatório) com 0

for (t in 1:treino){
u = treino_valida[t]
x = (1-a)*x + a*tanh( Win %*% rbind(1,u) + W %*% x )           #tanh é a função de ativação
if (t > initLen)
X[,t-initLen] = rbind(1,u,x)
}
X_T = t(X)
#Wout = Yt %*% X_T %*% solve( X %*% X_T + reg*diag(1+inSize+tam_reservoir))

#Prevendo os dados de validação
Y = matrix(0,outSize,(valida-1))
u = treino_valida[treino+1]

for (t in 1:(valida-1)){
x = (1-a)*x + a*tanh( Win %*% rbind(1,u) + W %*% x )
y = Wout %*% rbind(1,u,x)
Y[,t] = y
u = treino_valida[treino+t+1]
}

#Prevendo os dados de treino
Ytr = matrix(0,outSize,(treino-1))
u   = treino_valida[1]

for (j in 1:(treino-1)) {
x = (1-a)*x + a*tanh( Win %*% rbind(1,u) + W %*% x )
y = Wout %*% rbind(1,u,x)
Ytr[,j] = y
u = treino_valida[j+1]                               #corrigido [j+1] a partir desta versão
}
toc()

#Fitness = erro de treinamento * 0.4 e erro de validação * 0.6
#Cálculo dos erros
#mse_treino  =     (sum((    treino_valida[1:treino] - Ytr[outSize,1:treino])^2 )/treino)
#mse_valida  =     (sum((    treino_valida[(treino+1):(treino+valida)]-Y[outSize,1:valida])^2)/valida)
rmse_treino     = sqrt(sum((    treino_valida[2:treino] - Ytr[outSize,1:(treino-1)])^2)/(treino-1))
rmse_valida     = sqrt(sum((    treino_valida[(treino+2):(treino+valida)]-Y[outSize,1:(valida-1)])^2)/(valida-1))
rrse_treino     = sqrt(sum((    treino_valida[2:treino] - Ytr[outSize,1:(treino-1)])^2)/sum((treino_valida[2:treino] - train_media)^2))
rrse_valida     = sqrt(sum((    treino_valida[(treino+2):(treino+valida)]-Y[outSize,1:(valida-1)])^2)/sum((treino_valida[(treino+2):(treino+valida)]-valid_media)^2))
mae_treino      =      sum(abs( treino_valida[2:treino] - Ytr[outSize,1:(treino-1)]))  / (treino-1)
mae_valida      =      sum(abs( treino_valida[(treino+2):(treino+valida)]-Y[outSize,1:(valida-1)]))/(valida-1)
#mape_treino     =      sum(abs((treino_valida[2:treino] - Ytr[outSize,1:(treino-1)])   /treino_valida[2:treino]))/(treino-1)
#mape_valida     =      sum(abs((treino_valida[(treino+2):(treino+valida)]-Y[outSize,1:(valida-1)])/treino_valida[(treino+2):(treino+valida)]))/(valida-1)




print(paste('MAE  treino    = ',mae_treino))
print(paste('MAE  validação = ',mae_valida))
print(paste('MAE fitness 40%treino e 60%validação = ',mae_treino *0.4 + mae_valida*0.6))

print(paste('RMSE treino    = ',rmse_treino))
print(paste('RMSE validação = ',rmse_valida ))
print(paste('RMSE 40%treino e 60%validação = ',rmse_treino*0.4 + rmse_valida*0.6))
#print(paste('MAPE treino    = ',mape_treino))
#print(paste('MAPE validação = ',mape_valida))
#print(paste('MAPE 40%treino e 60%validação = ',mape_treino*0.4 + mape_valida*0.6))
#print(paste('RRSE treino    = ',rrse_treino))
#print(paste('RRSE validação = ',rrse_valida ))
#print(paste('RRSE 40%treino e 60%validação = ',rrse_treino*0.4 + rrse_valida*0.6))

#Geração de gráficos de resultados
#plot(ylab = "Preços observados e previstos (R$)", xlab = "Tempo (em dias)",treino_valida[(treino+1):(treino+valida)], type='l', col='green', lwd = 2)
#plot(ylab = "Preços observados e previstos (R$)", xlab = "Tempo (em dias)",treino_valida[(treino+1):(treino+valida)], type='l', col='green', lwd = 2)
#plot(ylim=c(0,50), ylab = "Prices observed and predicted with factor (R$)", xlab = "Date",data_date_1[(treino+1):(treino+valida)],treino_valida[(treino+1):(treino+valida)], type='l', col='green', lwd = 2) + lines(data_date_1[(treino+1):(treino+valida)],c(Y), col='black', lwd = 1 )
#title(main='(b)')
#legend('topright',legend=c('Target series', 'Predicted series'),
#title(main='Preços do fechamento diário da ITSA4')
#legend('topright',legend=c('Série alvo', 'Série prevista'), 
#col=c('green','black'), lty=1, bty='n' )

#plot(ylim=c(0,50), ylab = "Prices observed and predicted without factor (R$)", xlab = "Date",data_date_1[(treino+1):(treino+valida)],treino_valida[(treino+1):(treino+valida)], type='l', col='green', lwd = 2) + lines(data_date_1[(treino+1):(treino+valida)],c(Y), col='black', lwd = 1 )
#title(main='(a)')
#legend('topright',legend=c('Target series', 'Predicted series'),
#title(main='Preços do fechamento diário da ITSA4')
#legend('topright',legend=c('Série alvo', 'Série prevista'), 
# col=c('green','black'), lty=1, bty='n' )
#length(data_date_1)

#plot(ylab = "Preços observados e previstos (R$)", xlab = "Tempo (em dias)",treino_valida[(treino+1):(treino+valida)], type='l', col='green', lwd = 2)
#plot(ylab = "Preços observados e previstos (R$)", xlab = "Tempo (em dias)",treino_valida[(treino+1):(treino+valida)], type='l', col='green', lwd = 2)
#plot(ylim=c(0,50), ylab = "Prices observed with factor and predicted without factor (R$)", xlab = "Date",data_date_1[(treino+1):(treino+valida)],treino_valida[(treino+1):(treino+valida)], type='l', col='green', lwd = 2) + lines(data_date_1[(treino+1):(treino+valida)],c(Y), col='black', lwd = 1 )
#title(main='(b)')
#legend('topright',legend=c('Target series', 'Predicted series'),
#title(main='Preços do fechamento diário da ITSA4')
#legend('topright',legend=c('Série alvo', 'Série prevista'), 
#col=c('green','black'), lty=1, bty='n' )

#Resultados
#Treina sem factor e valida sem factor (retornos) 10000_1 (), elapsed time is 0.09 seconds v2.9.1.1
#Win e W: distribuição Uniforme
#MAE_treino             =  (recalculado)  (original arquivo)
#MAE_validação          =  (recalculado)  (original arquivo)
#MAE(40tr+60va) fitness =  (recalculado) (original arquivo)
#RMSE_treino            =  (recalculado)  (original arquivo)
#RMSE_validação         =  (recalculado)  (original arquivo)
#RMSE(40tr+60va)        =  (recalculado)  (original arquivo)
#MAPE_treino            =  (recalculado)  (original arquivo)
#MAPE_validação         =  (recalculado)  (original arquivo)
#MAPE(40tr+60va)        =  (recalculado)  (original arquivo)
#RRSE_treino            =  (recalculado)  (original arquivo)
#RRSE_validação         =  (recalculado)  (original arquivo)
#RRSE(40tr+60va)        =  (recalculado)  (original arquivo)

#Treina sem factor e valida sem factor (retornos) 10000_2 (), elapsed time is 0.2 seconds v.2.9.1.1
#Win e W: distribuição Uniforme
#MAE_treino             =  (recalculado)  (original arquivo)
#MAE_validação          =  (recalculado)  (original arquivo)
#MAE(40tr+60va) fitness =  (recalculado) (original arquivo)
#RMSE_treino            =  (recalculado)  (original arquivo)
#RMSE_validação         =  (recalculado)  (original arquivo)
#RMSE(40tr+60va)        =  (recalculado)  (original arquivo)
#MAPE_treino            =  (recalculado)  (original arquivo)
#MAPE_validação         =  (recalculado)  (original arquivo)
#MAPE(40tr+60va)        =  (recalculado)  (original arquivo)
#RRSE_treino            =  (recalculado)  (original arquivo)
#RRSE_validação         =  (recalculado)  (original arquivo)
#RRSE(40tr+60va)        =  (recalculado)  (original arquivo)

#Treina sem factor e testa sem factor (retornos) 10000_3 (), elapsed time is 0.1 seconds v.2.9.1.1
#Win e W: distribuição Uniforme
#MAE_treino             =  (recalculado)  (original arquivo)
#MAE_validação          =  (recalculado)  (original arquivo)
#MAE(40tr+60va) fitness =  (recalculado) (original arquivo)
#RMSE_treino            =  (recalculado)  (original arquivo)
#RMSE_validação         =  (recalculado)  (original arquivo)
#RMSE(40tr+60va)        =  (recalculado)  (original arquivo)
#MAPE_treino            =  (recalculado)  (original arquivo)
#MAPE_validação         =  (recalculado)  (original arquivo)
#MAPE(40tr+60va)        =  (recalculado)  (original arquivo)
#RRSE_treino            =  (recalculado)  (original arquivo)
#RRSE_validação         =  (recalculado)  (original arquivo)
#RRSE(40tr+60va)        =  (recalculado)  (original arquivo)




















#TESTE
#Dados de Treinamento x Dados de Teste
treina_testa  = c(data_simulate[1:treino],data_variance[(1:teste)])        #Sem factor, sem factor
#tail(treina_testa[1:treino])
#head(treina_testa[1:treino])
#treina_testa[3118]
#treina_testa
#length(treina_testa)          #4158

#Para cálculo do RRSE
test              = data_simulate[(treino+valida+1):(treino+valida+teste)]                #Sem factor
#plot(test,    type="l")
test_media        = mean(test)

#ESN
tic()
rhoW = abs(eigen(W,only.values=TRUE)$values[1])        #Autovalores da matriz W
W = sr * W / rhoW

X = matrix(0,1+inSize+tam_reservoir,treino-initLen)
Yt = matrix(treina_testa[(initLen+2):(treino+1)],1)      #Cria matriz treino-initLen x 1 com valores do fechamento
#View(Yt)
x = rep(0,tam_reservoir)                               #Preenche o vetor x (do tamanho do reservatório) com 0

for (t in 1:treino){
  u = treina_testa[t]
  x = (1-a)*x + a*tanh( Win %*% rbind(1,u) + W %*% x ) #tanh é a função de ativação
  if (t > initLen)
    X[,t-initLen] = rbind(1,u,x)
}

X_T = t(X)
#Wout = Yt %*% X_T %*% solve( X %*% X_T + reg*diag(1+inSize+tam_reservoir))

#Prevendo os dados de teste
Y = matrix(0,outSize,(teste-1))                            #Cria matriz outSize x teste com zeros
u = treina_testa[treino+1]

for (t in 1:(teste-1)) {
  x = (1-a)*x + a*tanh( Win %*% rbind(1,u) + W %*% x ) 
  y = Wout %*% rbind(1,u,x)
  Y[,t] = y
  u = treina_testa[treino+t+1]
}

#Prevendo os dados de treino
Ytr = matrix(0,outSize,(treino-1))
u   = treina_testa[1]

for (j in 1:(treino-1)) {
  x = (1-a)*x + a*tanh( Win %*% rbind(1,u) + W %*% x )
  y = Wout %*% rbind(1,u,x)
  Ytr[,j] = y
  u = treina_testa[j+1]                               
}
toc()

#Fitness = erro de treinamento * 0.4 e erro de teste * 0.6
#Cálculo dos erros
rmse_treino     = sqrt(sum((    treina_testa[2:treino] - Ytr[outSize,1:(treino-1)])^2 )/(treino-1))
rmse_teste      = sqrt(sum((    treina_testa[(treino+2):(treino+teste)]-Y[outSize,1:(teste-1)])^2)/(teste-1))
#rrse_treino     = sqrt(sum((    treina_testa[2:treino] - Ytr[outSize,1:(treino-1)])^2)/sum((treina_testa[1:(treino-1)] - train_media)^2))
#rrse_teste      = sqrt(sum((    treina_testa[(treino+2):(treino+teste)]-Y[outSize,1:(teste-1)])^2)/sum((treina_testa[(treino+2):(treino+teste)]-test_media)^2))
mae_treino      =      sum(abs( treina_testa[2:treino] - Ytr[outSize,1:(treino-1)])) / (treino-1)
mae_teste       =      sum(abs( treina_testa[(treino+2):(treino+teste)]-Y[outSize,1:(teste-1)]))/(teste-1)
#mape_treino     =      sum(abs((treina_testa[2:treino] - Ytr[outSize,1:(treino-1)])/treina_testa[2:treino]))/(treino-1)
#mape_teste      =      sum(abs((treina_testa[(treino+2):(treino+teste)]-Y[outSize,1:(teste-1)])/treina_testa[(treino+2):(treino+teste)]))/(teste-1)
mdae_treino =      median(abs( treina_testa[2:treino] - Ytr[outSize,1:(treino-1)]))
mdae_teste =      median(abs( treina_testa[(treino+2):(treino+valida)]-Y[outSize,1:(valida-1)]))


print(paste('MAE  treino = ',mae_treino))

print(paste('MAE  teste  = ',mae_teste))

print(paste('MAE fitness 40%treino e 60%teste = ',mae_treino*0.4 + mae_teste*0.6))

"--------------------------------------------------------"

print(paste('RMSE treino = ',rmse_treino))

print(paste('RMSE teste  = ',rmse_teste ))

print(paste('RMSE 40%treino e 60%teste = ',rmse_treino*0.4 + rmse_teste*0.6))

"---------------------------------------------------------"

print(paste('MDAE treino = ',mdae_treino))

print(paste('MDAE teste  = ',mdae_teste))

print(paste('MDAE 40%treino e 60%teste = ',mdae_treino*0.4 + mdae_teste*0.6))

"----------------------------------------------------------"

print(paste('RRSE treino = ',rrse_treino))

print(paste('RRSE teste  = ',rrse_teste ))

print(paste('RRSE 40%treino e 60%teste = ',rrse_treino*0.4 + rrse_teste*0.6))








#Para gerar gráficos
#plot(ylab = "Observed and forecasted prices (R$)", xlab = "Time (days)",treina_testa[(treino+1):(treino+teste)], type='l', col='green', lwd = 2)
#plot(ylab = "Preços observados e previstos (R$)", xlab = "Tempo (em dias)",treina_testa[(treino+1):(treino+teste)], type='l', col='green', lwd = 2)
#plot(ylab = "Observed prices without factor and predicted prices without factor (R$)", xlab = "Time (days)",treina_testa[(treino+1):(treino+teste)], type='l', col='green', lwd = 2)
#plot(ylab = "Observed prices with factor and predicted prices without factor (R$)", xlab = "Time (days)",treina_testa[(treino+1):(treino+teste)], type='l', col='green', lwd = 2)

data_date = as.matrix(read.csv2('ITSA4_retornos_close_2001-30-06-2023_com data.csv',header = F, sep = ","))

data_date_1 = as.Date(data_date[(treino+valida+1):(treino + valida + teste),1])

data_date_2 = as.numeric(data_variance[(1:teste)])

par(mfrow=c(1,2))
plot(ylab = "Variation predicted by the T de Student, Fitness RMSE", xlab = "Data",data_date_1[(2:teste)],treina_testa[(treino+2):(treino+teste)], type='l', col='green', lwd = 2) 
lines(data_date_1[(2:teste)],c(Y), col='black', lwd = 1)   #teste
title(main='(Distr.T de Student)')
legend('topright',legend=c('Target Series', 'Predicted series'),
       col=c('green','black'), lty=1, bty='n' )

plot(ylab = "Variation predicted by the uniform", xlab = "Data",data_date_1[(2:teste)],treina_testa[(treino+2):(treino+teste)], type='l', col='green', lwd = 2) 
lines(data_date_1[(2:teste)],c(Y), col='black', lwd = 1)   #teste
title(main='(Distr.Uniforme)')
legend('topright',legend=c('Target Series', 'Predicted series'),
       col=c('green','black'), lty=1, bty='n' )

#plot(ylim=c(10,90),ylab = "Prices observed with factor and forecasted with factor (R$)", xlab = "Date",data_date_1[(treino+1):(treino+valida)],treina_testa[(treino+1):(treino+teste)], type='l', col='green', lwd = 2) 
#lines(data_date_1[(treino+1):(treino+valida)],c(Y), col='black', lwd = 1)
#title(main='(c)')
#legend('topleft',legend=c('Target series', 'Forecast series'),
      # col=c('green','black'), lty=1, bty='n' )

#Resultados
#Treina sem factor e compara com série de teste sem factor (retornos) 10000_1 (), elapsed time is 0.08 seconds v. 2.9.1.1   #NORMAL
#MAE_treino             =  (recalculado)  (original)
#MAE_teste              =  ()  ()
#MAE(40tr+60te) fitness =  ()  ()
#RMSE_treino            =  ()  ()
#RMSE_teste             =  ()  ()
#RMSE(40tr+60te)        =  ()  ()
#MAPE_treino            =  ()  ()
#MAPE_teste             =  ()  ()
#MAPE(40tr+60te)        =  ()  ()
#RRSE_treino            =  ()  ()
#RRSE_teste             =  ()  ()
#RRSE(40tr+60te)        =  ()  ()

#Treina sem factor, valida sem factor e compara com série de teste sem factor (retornos) 10000_2 (), elapsed time is 0.22 seconds v. 2.9.1.1    #NORMAL
#MAE_treino             =  (0.0162646675564277)  (0.0162647566570097)
#MAE_teste              =  (0.0141478648261735)  (0.015104960305361)
#MAE(40tr+60va) fitness =  (0.0149945859182752)  (-0.021162331379691)
#RMSE_treino            =  (0.0220740128873528)  (0.0220753937195149)
#RMSE_teste             =  (0.0195333831527755)  (0.0205536231531417)
#RMSE(40tr+60va)        =  (0.0205496350466064)  (0.021162331379691)
#MAPE_treino            =  (infinitoo)  (infinitoo)
#MAPE_teste             =  (infinitoo)  (infinitoo)
#MAPE(40tr+60va)        =  (infitooo)  (infinitooo)
#RRSE_treino            =  (0.966769151107373)  (0.966892427937857)
#RRSE_teste             =  (1.00602110708304)  (0.996071561096693)
#RRSE(40tr+60va)        =  (0.990320324692771)  (0.984399907833159)

#Treina sem factor, valida sem factor e compara com série de teste sem factor (retornos) 10000_3 (), elapsed time is 0.22 seconds v. 2.9.1.1    #NORMAL
#MAE_treino             =  (0.01629170141639)  (0.0162906959453827)
#MAE_teste              =  (0.0141378421908836)  (0.0162906959453827)
#MAE(40tr+60va) fitness =  (0.0149993858810862)  (-0.0211824675050974)
#RMSE_treino            =  (0.0220831518614864)  (0.0220829691977074)
#RMSE_teste             =  (0.0197106529847442)  (0.0205821330433575)
#RMSE(40tr+60va)        =  (0.020659652535441)  (0.0211824675050974)
#MAPE_treino            =  (infinitoo)  (infinitooo)
#MAPE_teste             =  (infinitooo)  (infinitoo)
#MAPE(40tr+60va)        =  (infinitooo)  (infinitoo)
#RRSE_treino            =  (0.967169408111399)  (0.967224230513855)
#RRSE_teste             =  (1.01515097420409)  (0.997453209998318)
#RRSE(40tr+60va)        =  (0.995958347767016)  (0.985361618204532)
